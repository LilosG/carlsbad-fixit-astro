---
import Base from "../../layouts/Base.astro"
import JsonLd from "../../components/JsonLd.astro"
import { cities } from "../../data/cities"
import { services } from "../../data/services"

export async function getStaticPaths() {
  const paths = []
  for (const c of cities) {
    for (const s of services) {
      paths.push({ params: { city: c.slug, service: s.slug }, props: { city: c, service: s } })
    }
  }
  return paths
}

const { city, service } = Astro.props
const page = {
  title: `${service.name} in ${city.name} | San Diego HandyMan Pros`,
  description: `${service.name} in ${city.name}. Licensed, insured, and local.`,
  canonical: Astro.url ? Astro.url.href : undefined
}

const crumbs = [
  { name: "Home", url: "/" },
  { name: "Service Areas", url: "/service-areas" },
  { name: city.name, url: `/service-area/${city.slug}` },
  { name: service.name, url: Astro.url ? Astro.url.pathname : `/${city.slug}/${service.slug}` }
]

const breadcrumbLd = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": crumbs.map((c, i) => ({
    "@type": "ListItem",
    position: i + 1,
    name: c.name,
    item: new URL(c.url, Astro.site || "https://sandiegohandymanpro.co").href
  }))
}

const serviceLd = {
  "@context": "https://schema.org",
  "@type": "Service",
  "name": `${service.name} in ${city.name}`,
  "areaServed": city.name,
  "provider": { "@type": "LocalBusiness", "name": "San Diego HandyMan Pros", "telephone": "619-123-4567" }
}
---
<Base {page}>
  <section class="mx-auto max-w-7xl px-4 py-12">
    <nav class="text-sm text-gray-600"><a href="/">Home</a> / <a href="/service-areas">Service Areas</a> / <a href={`/service-area/${city.slug}`}>{city.name}</a> / <span class="font-medium">{service.name}</span></nav>
    <h1 class="mt-4 text-3xl font-semibold">{service.name} in {city.name}</h1>
    <p class="mt-4 max-w-2xl text-gray-700">{service.name} for homes and businesses in {city.name}. Get a fast, fair quote today.</p>
    <div class="mt-8">
      <a href="/contact" class="inline-block rounded-2xl px-5 py-3 bg-black text-white">Get a quote</a>
    </div>
    <div class="mt-12 grid gap-8 md:grid-cols-2">
      <div class="rounded-2xl border p-6">
        <h2 class="text-xl font-semibold">Why choose us</h2>
        <ul class="mt-3 list-disc pl-5 text-gray-700 space-y-2">
          <li>Licensed and insured technicians</li>
          <li>Same-week scheduling in {city.name}</li>
          <li>Upfront pricing with no surprises</li>
        </ul>
      </div>
      <div class="rounded-2xl border p-6">
        <h2 class="text-xl font-semibold">Nearby cities</h2>
        <ul class="mt-3 space-y-2 text-gray-700">
          {cities.filter(c => c.slug !== city.slug).slice(0,6).map(nc => (
            <li><a class="underline" href={`/${nc.slug}/${service.slug}`}>{service.name} in {nc.name}</a></li>
          ))}
        </ul>
      </div>
    </div>
  </section>
  <JsonLd data={breadcrumbLd} />
  <JsonLd data={serviceLd} />
</Base>
